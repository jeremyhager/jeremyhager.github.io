(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{140:function(t,e,n){"use strict";n.d(e,"a",(function(){return p})),n.d(e,"b",(function(){return u}));var a=n(0),r=n.n(a);function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var b=r.a.createContext({}),s=function(t){var e=r.a.useContext(b),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},p=function(t){var e=s(t.components);return r.a.createElement(b.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return r.a.createElement(r.a.Fragment,{},e)}},m=r.a.forwardRef((function(t,e){var n=t.components,a=t.mdxType,i=t.originalType,l=t.parentName,b=c(t,["components","mdxType","originalType","parentName"]),p=s(n),m=a,u=p["".concat(l,".").concat(m)]||p[m]||d[m]||i;return n?r.a.createElement(u,o(o({ref:e},b),{},{components:n})):r.a.createElement(u,o({ref:e},b))}));function u(t,e){var n=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var c in e)hasOwnProperty.call(e,c)&&(o[c]=e[c]);o.originalType=t,o.mdxType="string"==typeof t?t:a,l[1]=o;for(var b=2;b<i;b++)l[b]=n[b];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},73:function(t,e,n){"use strict";n.r(e),n.d(e,"frontMatter",(function(){return l})),n.d(e,"metadata",(function(){return o})),n.d(e,"rightToc",(function(){return c})),n.d(e,"default",(function(){return s}));var a=n(2),r=n(6),i=(n(0),n(140)),l={id:"creating-foreman-hosts",title:"Creating Foreman hosts (informational only)",sidebar_label:"Creating foreman hosts"},o={unversionedId:"creating-foreman-hosts",id:"creating-foreman-hosts",isDocsHomePage:!1,title:"Creating Foreman hosts (informational only)",description:"This is part of the Foreman tutorial series. Be sure to refer to the first tutorial if you have not already.",source:"@site/docs/creating-foreman-hosts.md",slug:"/creating-foreman-hosts",permalink:"/docs/creating-foreman-hosts",editUrl:"https://github.com/jeremyhager/yugawa-website/edit/master/docs/creating-foreman-hosts.md",version:"current",sidebar_label:"Creating foreman hosts",sidebar:"docs",previous:{title:"PXE boot using Foreman",permalink:"/docs/tftp-with-foreman"},next:{title:"Setting up ldap servers",permalink:"/docs/setting-up-ldap-servers"}},c=[{value:"Gathering info",id:"gathering-info",children:[{value:"Declaring Arrays",id:"declaring-arrays",children:[]}]},{value:"Provisioning Hosts",id:"provisioning-hosts",children:[]},{value:"Testing",id:"testing",children:[{value:"If the provisioning token has expired",id:"if-the-provisioning-token-has-expired",children:[]},{value:"Anaconda errors on package installation process",id:"anaconda-errors-on-package-installation-process",children:[]}]}],b={rightToc:c};function s(t){var e=t.components,n=Object(r.a)(t,["components"]);return Object(i.b)("wrapper",Object(a.a)({},b,n,{components:e,mdxType:"MDXLayout"}),Object(i.b)("div",{className:"admonition admonition-info alert alert--info"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"This is part of the Foreman tutorial series. Be sure to refer to the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/installing-foreman-with-katello"}),"first tutorial")," if you have not already."))),Object(i.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"This page is informational only. For each future host, a tutorial will be given on how to create the host in that moment."))),Object(i.b)("h2",{id:"gathering-info"},"Gathering info"),Object(i.b)("p",null,"QEMU/KVM will have the MAC address starting with 52:54:00-, and to keep things easy the MACs last octet will be set to the numerical IP address of the server."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Host"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"IP Address"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"MAC Address"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"ldap1.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.11"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:11")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"ldap2.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.12"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:12")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"postgresql1.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.13"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:13")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"postgresql2.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.14"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:14")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"iscsitgt-nfs.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.15"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:15")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"bacula.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.16"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:16")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"httpd1.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.17"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:17")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"httpd2.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.18"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:18")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"tomcat1.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.19"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:19")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"tomcat2.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.20"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:20")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"iptables.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.21"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:21")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"postfix.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.22"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:22")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"nagios.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.23"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:23")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"syslog.internal.virtnet"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"172.16.0.24"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"52:54:00:00:00:24")))),Object(i.b)("h3",{id:"declaring-arrays"},"Declaring Arrays"),Object(i.b)("p",null,"Use a for-loop with the above information. First, create arrays containing the hosts, ip address, and mac addresses:"),Object(i.b)("table",null,Object(i.b)("tr",null,Object(i.b)("td",null,Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike",metastring:'title="hosts array"',title:'"hosts','array"':!0}),"hostsArr=(\n    ldap1.internal.virtnet\n    ldap2.internal.virtnet\n    postgresql1.internal.virtnet\n    postgresql2.internal.virtnet\n    iscsitgt-nfs.internal.virtnet\n    bacula.internal.virtnet\n    httpd1.internal.virtnet\n    httpd2.internal.virtnet\n    tomcat1.internal.virtnet\n    tomcat2.internal.virtnet\n    iptables.internal.virtnet\n    postfix.internal.virtnet\n    nagios.internal.virtnet\n    syslog.internal.virtnet\n)\n"))),Object(i.b)("td",null,Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike",metastring:'title="IP array"',title:'"IP','array"':!0}),"IPArr=(\n    172.16.0.11\n    172.16.0.12\n    172.16.0.13\n    172.16.0.14\n    172.16.0.15\n    172.16.0.16\n    172.16.0.17\n    172.16.0.18\n    172.16.0.19\n    172.16.0.20\n    172.16.0.21\n    172.16.0.22\n    172.16.0.23\n    172.16.0.24\n)\n"))),Object(i.b)("td",null,Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-clike",metastring:'title="Mac array"',title:'"Mac','array"':!0}),"macArr=(\n    52:54:00:00:00:11\n    52:54:00:00:00:12\n    52:54:00:00:00:13\n    52:54:00:00:00:14\n    52:54:00:00:00:15\n    52:54:00:00:00:16\n    52:54:00:00:00:17\n    52:54:00:00:00:18\n    52:54:00:00:00:19\n    52:54:00:00:00:20\n    52:54:00:00:00:21\n    52:54:00:00:00:22\n    52:54:00:00:00:23\n    52:54:00:00:00:24\n)\n"))))),Object(i.b)("h2",{id:"provisioning-hosts"},"Provisioning Hosts"),Object(i.b)("p",null,'Because the number of hosts are the same as IP and Mac addresses, we can "cheat" a little and just index the host array:'),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'for i in ${!hostsArr[@]}; do \\\n    hammer host create \\\n        --name "${hostsArr[$i]}" \\\n        --hostgroup "centos7-group" \\\n        --interface "type=interface,mac=${macArr[$i]},ip=${IPArr[$i]},managed=true,primary=true,provision=true" \\\n        --location "Default Location"\ndone\n')),Object(i.b)("h2",{id:"testing"},"Testing"),Object(i.b)("p",null,"To view the provisioning script for the host, go the the following url in a browser:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"https://172.16.0.10/unattended/provision?spoof=172.16.0.11\n")),Object(i.b)("h3",{id:"if-the-provisioning-token-has-expired"},"If the provisioning token has expired"),Object(i.b)("p",null,"When going to the spoof url an error may pop up:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"unattended: provisioning token for host host.internal.virtnet expired\n")),Object(i.b)("p",null,"To fix, update the host and set the build flag to false, then true:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"hammer host update --build false --id $ID\nhammer host update --build true --id $ID\n")),Object(i.b)("p",null,"This occurs when the provisioning/build token expires for a build. Some discussion on this can be found ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://community.theforeman.org/t/build-token-expired-what-is-it-for-and-how-to-configure-it/7567/3"}),"here"),"."),Object(i.b)("h3",{id:"anaconda-errors-on-package-installation-process"},"Anaconda errors on package installation process"),Object(i.b)("p",null,"An odd issue can occur with using the repos as a medium vs. an ISO. This was reported on a recent (as of writing this article) ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://community.theforeman.org/t/error-populating-transaction-anaconda-is-retrying/20634/14"}),"community post"),'. The work around is to "touch" all rpms in the repo used. The curl command can be run anywhere that can reach the foreman server that has been set up. The small script has been adjusted for these tutorials.'),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash",metastring:"title=\"the following was a quick solution to just 'touch' all rpms\"",title:'"the',following:!0,was:!0,a:!0,quick:!0,solution:!0,to:!0,just:!0,"'touch'":!0,all:!0,'rpms"':!0}),'for i in {a..z}; do for j in `curl http://foreman.internal.virtnet/pulp/repos/Default_Organization/Library/custom/CentOS_7/x86_64/Packages/$i/| grep href |awk \'{print $2}\'|cut -f2 -d">"|cut -f1 -d"<"`; do curl http://foreman.internal.virtnet/pulp/repos/Default_Organization/Library/custom/CentOS_7/x86_64/Packages/$i/$j > /dev/null; done;done\nfor i in `curl http://foreman.internal.virtnet/pulp/repos/Default_Organization/Library/custom/CentOS_7/x86_64/Packages/3/| grep href |awk \'{print $2}\'|cut -f2 -d">"|cut -f1 -d"<"`; do curl http://foreman.internal.virtnet/pulp/repos/Default_Organization/Library/custom/CentOS_7/x86_64/Packages/3/$i > /dev/null; done\n')),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"This will take a bit to run."))))}s.isMDXComponent=!0}}]);