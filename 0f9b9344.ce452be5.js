(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{120:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),b=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=b(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=b(n),u=a,d=p["".concat(c,".").concat(u)]||p[u]||m[u]||o;return n?r.a.createElement(d,i(i({ref:t},s),{},{components:n})):r.a.createElement(d,i({ref:t},s))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,c=new Array(o);c[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var s=2;s<o;s++)c[s]=n[s];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},61:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return b}));var a=n(2),r=n(6),o=(n(0),n(120)),c={id:"creating-new-network",title:"Creating new VM network",sidebar_label:"Creating new VM network"},i={unversionedId:"creating-new-network",id:"creating-new-network",isDocsHomePage:!1,title:"Creating new VM network",description:"Create an the xml for an isolated network:",source:"@site/docs\\creating-new-network.md",slug:"/creating-new-network",permalink:"/docs/creating-new-network",editUrl:"https://github.com/jeremyhager/yugawa-website/edit/master/docs/creating-new-network.md",version:"current",sidebar_label:"Creating new VM network"},l=[{value:"Sources",id:"sources",children:[]}],s={rightToc:l};function b(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Create an the xml for an isolated network:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash",metastring:'title="/tmp/VMswitch.xml"',title:'"/tmp/VMswitch.xml"'}),'<network>\n <name>VMnetwork</name>\n <bridge name="VMnetwork"/>\n <ip address="172.16.0.1" netmask="255.255.0.0"/>\n</network>\n')),Object(o.b)("p",null,"Define the new network:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash",metastring:'title="virsh"',title:'"virsh"'}),"net-define /tmp/vmswitch.xml\n#Network VMnetwork defined from /tmp/vmswitch.xml\nnet-autostart VMnetwork\n#Network VMnetwork marked as autostarted\nnet-start VMnetwork\n#Network VMnetwork started\n")),Object(o.b)("p",null,"Create a new vm with 2 interfaces:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo virt-install --connect qemu:///system \\\n     --network=bridge:virbr0 \\\n     --network=bridge:VMnetwork \\\n     -n router \\\n     -f /home/imgs/router.img \\\n     -r 1024 \\\n     -s 12 \\\n     --cdrom=/home/isos/pfSense-CE-2.4.5-RELEASE-p1-amd64.iso \\\n     --os-type=freebsd11.3 \\\n     --accelerate --hvm --graphics vnc\n")),Object(o.b)("p",null,"Because the graphics specified will be vnc, this particular method requires some sort of graphical viewer at least for the initial install. For this guide, all install methods were left as default and the machine simply rebooted after install."),Object(o.b)("p",null,"Some guessing needed to be involved, but for now WAN and LAN was set as follows:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"WAN -> vtnet0\nLAN -> vtnet1\n")),Object(o.b)("p",null,'Run the following commands to disable the packet filter (and allow changes to be made from the "WAN" side):'),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"8\n# starts access to the shell\npfctl -d\n# disables packet filter\n")),Object(o.b)("p",null,"Now log into the WAN interface using the default username and password of pfsense:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"admin\npfsense\n")),Object(o.b)("p",null,"Then enter the following for hostname and domain:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"hostname: router\ndomain: internal.virtnet\n")),Object(o.b)("p",null,"Set the WAN interface to static:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"IP Address: 192.168.86.4\nSubnet Mask: 24\nUpstream Gateway: 192.168.86.1\n")),Object(o.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"Turn off RF1918: Block RFC1918 Private Networks")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},'Make sure to uncheck "Block private networks from entering via WAN, as the WAN interface is within a LAN.'))),Object(o.b)("p",null,"LAN IP:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text"}),"IP: 172.16.0.2\nSubnet Mask: 16\n")),Object(o.b)("p",null,"Then set the admin password."),Object(o.b)("p",null,"Once again it may be necessary to go back to the console and disable the packet filter again."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"pfctl -d\n")),Object(o.b)("p",null,"Then sign back into the router via the web gui. Finally, allow open access to the gui:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"System -> Rules -> WAN -> Add"),Object(o.b)("li",{parentName:"ol"},"Action: Pass"),Object(o.b)("li",{parentName:"ol"},"Interface: WAN"),Object(o.b)("li",{parentName:"ol"},"Protocol: TCP"),Object(o.b)("li",{parentName:"ol"},"Source: Network - 192.168.86.0 /24"),Object(o.b)("li",{parentName:"ol"},"Destination: WAN Address"),Object(o.b)("li",{parentName:"ol"},"Destination port range: HTTPS"),Object(o.b)("li",{parentName:"ol"},"Description (optional): Allow remote management from home LAN"),Object(o.b)("li",{parentName:"ol"},"Save"),Object(o.b)("li",{parentName:"ol"},"Apply Changes")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Because the WAN interface is actually within a WAN, thus behind a firewall/router, the above steps were not of a concern. If however this is created with a public IP interface, then an alternative method should be sought."))),Object(o.b)("p",null,"Finally, renable the packet filter back in the VM console if it hasn't been already:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"pfctl -e\n")),Object(o.b)("p",null,"Add a rule to allow port 22 from the WAN net to the LAN net. This will allow a device to connect to any server within the VM LAN."),Object(o.b)("h2",{id:"sources"},"Sources"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://forum.netgate.com/topic/22082/newbie-enable-wan-using-shell/3"}),"Using the shell to open pfsense")," ",Object(o.b)("sup",null,Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://web.archive.org/web/20201005172112if_/https://forum.netgate.com/topic/22082/newbie-enable-wan-using-shell"}),"archive"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.netgate.com/pfsense/en/latest/usermanager/defaults.html?highlight=username"}),"Default username and password for pfsense")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"https://docs.netgate.com/pfsense/en/latest/recipes/remote-firewall-administration.html#i-don-t-care-about-security-how-do-i-open-access-to-the-gui"}),"Expose pfsense GUI on WAN"))))}b.isMDXComponent=!0}}]);