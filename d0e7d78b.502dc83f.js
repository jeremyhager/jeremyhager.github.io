(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{105:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return b}));var n=a(2),r=a(6),i=(a(0),a(122)),o={id:"pfsense-as-vm",title:"pfSense as a VM",sidebar_label:"pfSense as a VM"},c={unversionedId:"pfsense-as-vm",id:"pfsense-as-vm",isDocsHomePage:!1,title:"pfSense as a VM",description:"Create a new vm with 2 interfaces:",source:"@site/docs/pfsense-as-vm.md",slug:"/pfsense-as-vm",permalink:"/docs/pfsense-as-vm",editUrl:"https://github.com/jeremyhager/yugawa-website/edit/master/docs/pfsense-as-vm.md",version:"current",sidebar_label:"pfSense as a VM",sidebar:"docs",previous:{title:"Creating new VM network",permalink:"/docs/creating-new-network"}},l=[{value:"Create a new vm with 2 interfaces:",id:"create-a-new-vm-with-2-interfaces",children:[]},{value:"Initial configuration",id:"initial-configuration",children:[{value:"Allow changes from WAN interface",id:"allow-changes-from-wan-interface",children:[]},{value:"Log into WAN interface from home LAN",id:"log-into-wan-interface-from-home-lan",children:[]},{value:"Hostname and domain",id:"hostname-and-domain",children:[]},{value:"WAN configuration",id:"wan-configuration",children:[]},{value:"LAN configuration",id:"lan-configuration",children:[]},{value:"Allow access to the web console via WAN interface",id:"allow-access-to-the-web-console-via-wan-interface",children:[]}]},{value:"Add a rule - port 22",id:"add-a-rule---port-22",children:[]},{value:"Disable DHCP",id:"disable-dhcp",children:[]},{value:"Sources",id:"sources",children:[]}],s={rightToc:l};function b(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"create-a-new-vm-with-2-interfaces"},"Create a new vm with 2 interfaces:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo virt-install --connect qemu:///system \\\n     --network=bridge:virbr0 \\\n     --network=bridge:VMnetwork \\\n     -n router \\\n     -f /home/imgs/router.img \\\n     -r 1024 \\\n     -s 12 \\\n     --cdrom=/home/isos/pfSense-CE-2.4.5-RELEASE-p1-amd64.iso \\\n     --os-type=freebsd11.3 \\\n     --accelerate --hvm --graphics vnc\n")),Object(i.b)("h2",{id:"initial-configuration"},"Initial configuration"),Object(i.b)("p",null,"Because the graphics specified will be vnc, this particular method requires some sort of graphical viewer at least for the initial install. For this guide, all install methods were left as default and the machine simply rebooted after install."),Object(i.b)("p",null,"Some guessing needed to be involved, but for now WAN and LAN was set as follows:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"WAN -> vtnet0\nLAN -> vtnet1\n")),Object(i.b)("h3",{id:"allow-changes-from-wan-interface"},"Allow changes from WAN interface"),Object(i.b)("p",null,'Run the following commands to disable the packet filter (and allow changes to be made from the "WAN" side):'),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"8\n# starts access to the shell\npfctl -d\n# disables packet filter\n")),Object(i.b)("h3",{id:"log-into-wan-interface-from-home-lan"},"Log into WAN interface from home LAN"),Object(i.b)("p",null,"Now log into the WAN interface using the default username and password of pfsense:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"admin\npfsense\n")),Object(i.b)("h3",{id:"hostname-and-domain"},"Hostname and domain"),Object(i.b)("p",null,"Then enter the following for hostname and domain:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"hostname: router\ndomain: internal.virtnet\n")),Object(i.b)("h3",{id:"wan-configuration"},"WAN configuration"),Object(i.b)("p",null,"Set the WAN interface to static:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"IP Address: 192.168.86.4\nSubnet Mask: 24\nUpstream Gateway: 192.168.86.1\n")),Object(i.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"Turn off RF1918: Block RFC1918 Private Networks")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},'Make sure to uncheck "Block private networks from entering via WAN, as the WAN interface is within a LAN.'))),Object(i.b)("h3",{id:"lan-configuration"},"LAN configuration"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"IP: 172.16.0.2\nSubnet Mask: 16\n")),Object(i.b)("p",null,"Then set the admin password."),Object(i.b)("p",null,"It may be necessary to go back to the console and disable the packet filter again."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"pfctl -d\n")),Object(i.b)("h3",{id:"allow-access-to-the-web-console-via-wan-interface"},"Allow access to the web console via WAN interface"),Object(i.b)("p",null,"Then sign back into the router via the web gui. Finally, allow open access to the gui:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"System -> Rules -> WAN -> Add"),Object(i.b)("li",{parentName:"ol"},"Action: Pass"),Object(i.b)("li",{parentName:"ol"},"Interface: WAN"),Object(i.b)("li",{parentName:"ol"},"Protocol: TCP"),Object(i.b)("li",{parentName:"ol"},"Source: Network - 192.168.86.0 /24"),Object(i.b)("li",{parentName:"ol"},"Destination: WAN Address"),Object(i.b)("li",{parentName:"ol"},"Destination port range: HTTPS"),Object(i.b)("li",{parentName:"ol"},"Description (optional): Allow remote management from home LAN"),Object(i.b)("li",{parentName:"ol"},"Save"),Object(i.b)("li",{parentName:"ol"},"Apply Changes")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Because the WAN interface is actually within a WAN, thus behind a firewall/router, the above steps were not of a concern. If however this is created with a public IP interface, then an alternative method should be sought."))),Object(i.b)("p",null,"Reenable the packet filter back in the VM console if it hasn't been already:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"pfctl -e\n")),Object(i.b)("h2",{id:"add-a-rule---port-22"},"Add a rule - port 22"),Object(i.b)("p",null,"Add a rule to allow port 22 from the WAN net to the LAN net. This will allow a device from the WAN network to connect to any server within the LAN via ssh."),Object(i.b)("h2",{id:"disable-dhcp"},"Disable DHCP"),Object(i.b)("p",null,"Go to Services -> DHCP Server -> LAN, and uncheck ",Object(i.b)("inlineCode",{parentName:"p"},"Enable DHCP server on LAN interface")),Object(i.b)("h2",{id:"sources"},"Sources"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"https://forum.netgate.com/topic/22082/newbie-enable-wan-using-shell/3"}),"Using the shell to open pfsense")," ",Object(i.b)("sup",null,Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"https://web.archive.org/web/20201005172112if_/https://forum.netgate.com/topic/22082/newbie-enable-wan-using-shell"}),"archive"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"https://docs.netgate.com/pfsense/en/latest/usermanager/defaults.html?highlight=username"}),"Default username and password for pfsense")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"https://docs.netgate.com/pfsense/en/latest/recipes/remote-firewall-administration.html#i-don-t-care-about-security-how-do-i-open-access-to-the-gui"}),"Expose pfsense GUI on WAN"))))}b.isMDXComponent=!0},122:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=r.a.createContext({}),b=function(e){var t=r.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},p=function(e){var t=b(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=b(a),m=n,u=p["".concat(o,".").concat(m)]||p[m]||d[m]||i;return a?r.a.createElement(u,c(c({ref:t},s),{},{components:a})):r.a.createElement(u,c({ref:t},s))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:n,o[1]=c;for(var s=2;s<i;s++)o[s]=a[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);