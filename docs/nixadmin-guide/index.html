<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.61">
<title data-react-helmet="true">Linux Sysadmin Main Guide | Yugawa</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Linux Sysadmin Main Guide | Yugawa"><meta data-react-helmet="true" name="description" content="Main Guide"><meta data-react-helmet="true" property="og:description" content="Main Guide"><meta data-react-helmet="true" property="og:url" content="https://yugawa.xyz/docs/nixadmin-guide"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://yugawa.xyz/docs/nixadmin-guide"><link rel="stylesheet" href="/styles.519155b8.css">
<link rel="preload" href="/styles.e4f3d5e7.js" as="script">
<link rel="preload" href="/runtime~main.76a09938.js" as="script">
<link rel="preload" href="/main.31b8a9dc.js" as="script">
<link rel="preload" href="/1.8454080d.js" as="script">
<link rel="preload" href="/2.ab6bdf19.js" as="script">
<link rel="preload" href="/44.edfd3eaf.js" as="script">
<link rel="preload" href="/45.12e107f5.js" as="script">
<link rel="preload" href="/20ac7829.38194861.js" as="script">
<link rel="preload" href="/17896441.d42081da.js" as="script">
<link rel="preload" href="/9032a040.c816d1e5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">Yugawa</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/aboutMe">About Me</a><a href="https://github.com/jeremyhager/yugawa-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">Yugawa</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/aboutMe">About Me</a></li><li class="menu__list-item"><a href="https://github.com/jeremyhager/yugawa-website" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Internal.VirtNet</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Internal.Virtnet Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/centos8-hypervisor">Hypervisor Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/documentation-server">Documentation Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/foreman">Foreman Configuration</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/nixadmin-guide">Linux Sysadmin Main Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux-admin-roadmap">Linux Admin Roadmap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops-guide">DevOps Guide</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Linux Sysadmin Main Guide</h1></header><div class="markdown"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="main-guide"></a>Main Guide<a aria-hidden="true" tabindex="-1" class="hash-link" href="#main-guide" title="Direct link to heading">#</a></h3><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>This will be used as the main guide, however the other guides in Docs/Guides will be used as reference and to double-check what I&#x27;m learning.</p></div></div><p>1) Set up a KVM hypervisor.<br>
<a href="/docs/centos8-hypervisor"><img src="/img/Status-Completed-brightgreen.svg" alt="img"></a></p><p>2) Inside of that KVM hypervisor, install a <del>Spacewalk</del> <strong>Foreman</strong> server. Use CentOS <del>6</del> <strong>7</strong> as the distro for all work below. (For bonus points, set up errata importation on the CentOS channels, so you can properly see security update advisory information.).<br>
<a href="/docs/foreman"><img src="/img/Status-In-Progress-blueviolet.svg" alt="img"></a></p><p>3) Create a VM to provide named and dhcpd service to your entire environment. Set up the dhcp daemon to use the <del>Spacewalk</del> <strong>Foreman</strong> server as the pxeboot machine (thus allowing you to use Cobbler to do unattended OS installs). Make sure that every forward zone you create has a reverse zone associated with it. Use something like &quot;internal.virtnet&quot; (but not &quot;.local&quot;) as your internal DNS zone.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>4) Use that <del>Spacewalk</del> <strong>Foreman</strong> server to automatically (without touching it) install a new pair of OS instances, with which you will then create a Master/Master pair of LDAP servers. Make sure they register with the <del>Spacewalk</del> <strong>Foreman</strong> server. Do not allow anonymous bind, do not use unencrypted LDAP.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>5) Reconfigure all 3 servers to use LDAP authentication. <em>(use <code>freeipa</code>)</em><br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>6) Create two new VMs, again unattendedly, which will then be Postgresql VMs. Use pgpool-II to set up master/master replication between them. Export the database from your <del>Spacewalk</del> <strong>Foreman</strong> server and import it into the new pgsql cluster. Reconfigure your <del>Spacewalk</del> <strong>Foreman</strong> instance to run off of that server.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>7) Set up a Puppet Master. Plug it into the <del>Spacewalk</del> <strong>Foreman</strong> server for identifying the inventory it will need to work with. (Cheat and use ansible for deployment purposes, again plugging into the <del>Spacewalk</del> <strong>Foreman</strong> server.)<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>8) Deploy another VM. Install iscsitgt and nfs-kernel-server on it. Export a LUN and an NFS share.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>9) Deploy another VM. Install bacula on it, using the postgresql cluster to store its database. Register each machine on it, storing to flatfile. Store the bacula VM&#x27;s image on the iscsi LUN, and every other machine on the NFS share.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>10) Deploy two more VMs. These will have httpd (Apache2) on them. Leave essentially default for now.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>11) Deploy two more VMs. These will have tomcat on them. Use JBoss Cache to replicate the session caches between them. Use the httpd servers as the frontends for this. The application you will run is JBoss Wiki.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>12) You guessed right, deploy another VM. This will do iptables-based NAT/round-robin loadbalancing between the two httpd servers.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>13) Deploy another VM. On this VM, install postfix. Set it up to use a gmail account to allow you to have it send emails, and receive messages only from your internal network.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>14) Deploy another VM. On this VM, set up a Nagios server. Have it use snmp to monitor the communication state of every relevant service involved above. This means doing a &quot;is the right port open&quot; check, and a &quot;I got the right kind of response&quot; check and &quot;We still have filesystem space free&quot; check.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>15) Deploy another VM. On this VM, set up a syslog daemon to listen to every other server&#x27;s input. Reconfigure each other server to send their logging output to various files on the syslog server. (For extra credit, set up logstash or kibana or greylog to parse those logs.) <em>(use elk stack)</em><br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>16) Document every last step you did in getting to this point in your brand new Wiki.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>17) Now go back and create Puppet Manifests to ensure that every last one of these machines is authenticating to the LDAP servers, registered to the <del>Spacewalk</del> <strong>Foreman</strong> server, and backed up by the bacula server.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>18) Now go back, reference your documents, and set up a Puppet Razor profile that hooks into each of these things to allow you to recreate, from scratch, each individual server.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>19) Destroy every secondary machine you&#x27;ve created and use the above profile to recreate them, joining them to the clusters as needed.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><p>20) Bonus exercise: create three more VMs. A CentOS <del>5, 6, and 7</del> <strong>6, 7, 8</strong> machine. On each of these machines, set them up to allow you to create custom RPMs and import them into the <del>Spacewalk</del> <strong>Foreman</strong> server instance. Ensure your Puppet configurations work for all three and produce like-for-like behaviors.<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"> </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="extra-extra-credit"></a>Extra-extra Credit<a aria-hidden="true" tabindex="-1" class="hash-link" href="#extra-extra-credit" title="Direct link to heading">#</a></h3><p>Get Foreman to work with Chef<br>
<img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="more-stuff-to-learn-not-implied-or-direct-from-above"></a>More stuff to learn, not implied or direct from above<a aria-hidden="true" tabindex="-1" class="hash-link" href="#more-stuff-to-learn-not-implied-or-direct-from-above" title="Direct link to heading">#</a></h3><table><thead><tr><th>Languages</th><th>CI/CD</th><th>Containers</th><th>Infrastructure Monitoring</th><th>Cloud Providers</th></tr></thead><tbody><tr><td>Python <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td><td>Jenkins <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td><td>Kubernetes <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td><td>Prometheus <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td><td>AWS <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td></tr><tr><td>Ruby <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td><td>GitHub Actions <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td><td>Docker <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td><td>Datadog <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td><td>Azure <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td></tr><tr><td>Go <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td><td></td><td></td><td></td><td>Digital Ocean <img src="/img/Status-Not-Started-lightgrey.svg" alt="img"></td></tr></tbody></table><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><em>Table is listed in level of understanding I think I <strong>should</strong> have. Eg. I should get more experience with Python than Ruby, and more Ruby than Go.</em></p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sources"></a>Sources<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sources" title="Direct link to heading">#</a></h3><p>The original source of this has been modified to include a Foreman server, using freeipa for LDAP, and elk stack for central logs.</p><ul><li><a href="https://old.reddit.com/r/linuxadmin/comments/2s924h/how_did_you_get_your_start/cnnw1ma/?context=3" target="_blank" rel="noopener noreferrer">original source of main guide</a></li><li><a href="https://old.reddit.com/r/linuxadmin/comments/8wvowf/update_on_uiconrad_list_for_2018/e1zpwfv/" target="_blank" rel="noopener noreferrer">modified source of main guide</a></li><li><a href="/docs/devops-guide">More stuff to learn source</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/jeremyhager/yugawa-website/edit/master/docs/nixadmin-guide.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/foreman"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Foreman Configuration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/linux-admin-roadmap"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Linux Admin Roadmap Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#main-guide" class="table-of-contents__link">Main Guide</a></li><li><a href="#extra-extra-credit" class="table-of-contents__link">Extra-extra Credit</a></li><li><a href="#more-stuff-to-learn-not-implied-or-direct-from-above" class="table-of-contents__link">More stuff to learn, not implied or direct from above</a></li><li><a href="#sources" class="table-of-contents__link">Sources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Internal.Virtnet Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/nixadmin-guide/">Linux Sysadmin Guide</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 Jeremy Hager. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.e4f3d5e7.js"></script>
<script src="/runtime~main.76a09938.js"></script>
<script src="/main.31b8a9dc.js"></script>
<script src="/1.8454080d.js"></script>
<script src="/2.ab6bdf19.js"></script>
<script src="/44.edfd3eaf.js"></script>
<script src="/45.12e107f5.js"></script>
<script src="/20ac7829.38194861.js"></script>
<script src="/17896441.d42081da.js"></script>
<script src="/9032a040.c816d1e5.js"></script>
</body>
</html>