(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{134:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return p})),n.d(t,"default",(function(){return i}));var a=n(2),r=n(6),l=(n(0),n(140)),s={id:"postgres-pgpool-install",title:"Postgresql and pgpool-II install",sidebar_label:"Postgres and pgpool-II"},o={unversionedId:"postgres-pgpool-install",id:"postgres-pgpool-install",isDocsHomePage:!1,title:"Postgresql and pgpool-II install",description:"On both VMs",source:"@site/docs/postgres-pgpool-install.md",slug:"/postgres-pgpool-install",permalink:"/docs/postgres-pgpool-install",editUrl:"https://github.com/jeremyhager/yugawa-website/edit/master/docs/postgres-pgpool-install.md",version:"current",sidebar_label:"Postgres and pgpool-II"},p=[{value:"On both VMs",id:"on-both-vms",children:[{value:"Install Postgresql and pgpool-II",id:"install-postgresql-and-pgpool-ii",children:[]}]},{value:"Set up Postgresql",id:"set-up-postgresql",children:[{value:"On postgresql1",id:"on-postgresql1",children:[]},{value:"Creating databases",id:"creating-databases",children:[]},{value:"Test databases",id:"test-databases",children:[]}]},{value:"Sources",id:"sources",children:[]}],c={rightToc:p};function i(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h2",{id:"on-both-vms"},"On both VMs"),Object(l.b)("h3",{id:"install-postgresql-and-pgpool-ii"},"Install Postgresql and pgpool-II"),Object(l.b)("p",null,"Install postgresql 12 and pgpool-II for postgresql 12"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo yum -y install postgresql12-server postgresql12-contrib\nsudo /usr/pgsql-12/bin/postgresql-12-setup initdb\nsudo systemctl enable --now postgresql-12\nsudo yum -y install pgpool-II-pg12-extensions\n")),Object(l.b)("p",null,"Allow postgresql and pgpool-II in the firewall"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash",metastring:'title="postgresql firewall rules"',title:'"postgresql',firewall:!0,'rules"':!0}),"sudo firewall-cmd --permanent --add-service=postgresql\nsudo firewall-cmd --reload\n")),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash",metastring:'title="pgpool-II firewall rules"',title:'"pgpool-II',firewall:!0,'rules"':!0}),"sudo firewall-cmd --permanent --zone=public --add-port=9999/tcp --add-port=9898/tcp --add-port=9000/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=9694/udp\nsudo firewall-cmd --reload\n")),Object(l.b)("p",null,"Finally enable the pgpool-II service:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo systemctl enable --now pgpool.service\n")),Object(l.b)("h2",{id:"set-up-postgresql"},"Set up Postgresql"),Object(l.b)("h3",{id:"on-postgresql1"},"On postgresql1"),Object(l.b)("p",null,"Uncomment ",Object(l.b)("inlineCode",{parentName:"p"},"listen_address")," and change to ",Object(l.b)("inlineCode",{parentName:"p"},"*"),":"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash",metastring:'title="/var/lib/pgsql/12/data/postgresql.conf"',title:'"/var/lib/pgsql/12/data/postgresql.conf"'}),"...\nlisten_address = '*'\n...\n")),Object(l.b)("p",null,"Add the following entry at the bottom of the ",Object(l.b)("inlineCode",{parentName:"p"},"pg_hba")," file:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash",metastring:'title="/var/lib/pgsql/12/data/pg_hba.conf"',title:'"/var/lib/pgsql/12/data/pg_hba.conf"'}),"...\nhost    all             all             172.16.0.10/16          md5\n")),Object(l.b)("p",null,"Restart postgresql-12:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo systemctl restart postgresql-12\n")),Object(l.b)("h3",{id:"creating-databases"},"Creating databases"),Object(l.b)("p",null,"Switch to postgres user, start postgres client:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo su - postgres -c psql\n")),Object(l.b)("p",null,"Create databases:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sql"}),"CREATE USER \"foreman\" WITH PASSWORD '<FOREMAN_PASSWORD>';\nCREATE USER \"candlepin\" WITH PASSWORD '<CANDLEPIN_PASSWORD>';\nCREATE DATABASE foreman OWNER foreman;\nCREATE DATABASE candlepin OWNER candlepin;\n")),Object(l.b)("h3",{id:"test-databases"},"Test databases"),Object(l.b)("p",null,"From the foreman sever:"),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash",metastring:'title="foreman.internal.virtnet"',title:'"foreman.internal.virtnet"'}),"PGPASSWORD='<FOREMAN_PASSWORD>' psql -h postgresql1.internal.virtnet -p 5432 -U foreman -d foreman -c \"SELECT 1 as ping\"\n")),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash",metastring:'title="foreman.internal.virtnet"',title:'"foreman.internal.virtnet"'}),"PGPASSWORD='<CANDLEPIN_PASSWORD>' psql -h postgresql1.internal.virtnet -p 5432 -U candlepin -d candlepin -c \"SELECT 1 as ping\"\n")),Object(l.b)("pre",null,Object(l.b)("code",Object(a.a)({parentName:"pre"},{className:"language-text",metastring:'title="expected output"',title:'"expected','output"':!0})," ping\n------\n    1\n(1 row)\n")),Object(l.b)("h2",{id:"sources"},"Sources"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.postgresql.org/download/linux/redhat/"}),"Download postgresql")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(a.a)({parentName:"li"},{href:"https://theforeman.org/plugins/katello/nightly/user_guide/remote_databases/index.html#prepare-remote-postgres"}),"How to install postgresql - Foreman")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-centos-7#step-1-%E2%80%94-installing-postgresql"}),"How to install postgresql - Digital Ocean")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.pgpool.net/docs/42/en/html/pgpool-ii-user.html"}),"Create pgpool user account")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(a.a)({parentName:"li"},{href:"https://access.redhat.com/solutions/674323"}),"How to configure postgresql to authenticate with ipa")," Warning: login required")))}i.isMDXComponent=!0},140:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return d}));var a=n(0),r=n.n(a);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),i=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},b=function(e){var t=i(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},g=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),b=i(n),g=a,d=b["".concat(s,".").concat(g)]||b[g]||u[g]||l;return n?r.a.createElement(d,o(o({ref:t},c),{},{components:n})):r.a.createElement(d,o({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,s=new Array(l);s[0]=g;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,s[1]=o;for(var c=2;c<l;c++)s[c]=n[c];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,n)}g.displayName="MDXCreateElement"}}]);